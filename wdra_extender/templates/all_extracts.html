{% extends 'base.html' %}

{% block extra_head %}
<script type="text/javascript">
    $(document).ready(function() {
        {% for _extract in user_extracts %}
            check_long_task('{{ url_for('tools.task_status', task_id=_extract.uuid) }}', $('#progress_bar_'+'{{ _extract.uuid }}'), $('#progress_status_'+'{{ _extract.uuid }}'), $('#progress_message_'+'{{ _extract.uuid }}'));
        {% endfor %}
    });
</script>
{% endblock %}

{% block content %}
<h1>Past Extracts</h1>

<a class="btn btn-prima`ry btn-lg btn-block" href="{{ url_for('auth.profile') }}">
    Home
</a>

{% for _extract in user_extracts %}
    <hr>
    <tr>
        <td>
            Extract ID: {{ _extract.uuid }}<br>
            Search Method: {{ _extract.extract_method }}<br>
            Search Endpoint: {{ _extract.search_settings.get('endpoint') }}<br>
            Search String: {{ _extract.query_string }}<br>
            Tweets Requested: {{ _extract.search_settings.get('max_results') }}<br>
        </td>
    {% if (_extract.building == False and _extract.queuing == False) %}
        <td>
            {% if _extract.is_ready() %}
                <a class="btn btn-prima`ry btn-lg btn-block"
                   href="{{ url_for('extract.download_extract', extract_uuid=_extract.uuid) }}">
                    Download
                </a>
            {% else %}
                <a class="btn btn-prima`ry btn-lg btn-block"
                   href="{{ url_for('extract.rebuild_extract', extract_uuid=_extract.uuid) }}">
                    Recreate
                </a>
            {%  endif %}
        </td>
        <td>
            {% if _extract.is_ready() %}
                <a class="btn btn-prima`ry btn-lg btn-block"
                   href="{{ url_for('extract.delete_extract_data', extract_uuid=_extract.uuid) }}">
                    Delete extract data.
                </a>
            {% else %}
                <button class="btn btn-info btn-lg btn-block"
                disabled>
                    Extract {{ _extract.uuid }} has no output file.
                </button>
            {% endif %}
        </td>
        <td>
            <a class="btn btn-prima`ry btn-lg btn-block"
               href="{{ url_for('extract.delete_extract', extract_uuid=_extract.uuid) }}">
                Delete extract.
            </a>
        </td>
    {% else %}
        <td>
        <tr>
            Your extract is, <a id="progress_status_{{ _extract.uuid }}"></a>, check back soon.
        </tr>
        <tr>
            <div id="progress_bar_{{ _extract.uuid }}"></div>
        </tr>
        <tr>
            Msg: <a id="progress_message_{{ _extract.uuid }}"></a>
        </tr>
        <tr>
            <a class="btn btn-prima`ry btn-lg btn-block"
               href="{{ url_for('tools.kill_task', task_id=_extract.uuid) }}">
                Delete job.
            </a>
        </tr>
        </td>
    {% endif %}
    </tr>
    <hr>
{% endfor %}

{% endblock %}
